<hr>
<%= form_for (:task), url: user_tasks_path(current_locale, current_user.id), method: :post, :html => {:role => 'form', :class => 'form', :id => 'form'} do |f| %>

  <% if @task.errors.any? %>
	<div id="error_explanation">
	  <h2>
	    <%= pluralize(@task.errors.count, "error") %> prohibited
	      this task from being saved:
	  </h2>
	  <ul>
	    <% @task.errors.full_messages.each do |msg| %>
	      <li><%= msg %></li>
	    <% end %>
	  </ul>
	</div>
  <% end %>

  <%= label_tag 'Section' %>
  <br>
  <%= f.radio_button :section, :ror, {checked: true} %>
  <%= f.label :section_ror, 'Ruby on Rails' %>

  <%= f.radio_button :section, :java %>
  <%= f.label :section_java, 'Java' %>

  <%= f.radio_button :section, :python %>
  <%= f.label :section_python, 'Python' %>

  <%= f.radio_button :section, :net %>
  <%= f.label :section_net, '.NET' %>

  <div class="form-group">
    <%= f.label :name %>
    <%= f.text_field :name, :class => 'form-control input-sm' %>
  </div>
 
  <div class="form-group">
    <%= f.label :description %>
    <%= f.text_area :description, :class => 'form-control input-sm', :data => {:provide => "markdown"} %>
  </div>

  <%= link_to "Upload images", '#', id: 'upload_widget_opener', class: 'btn btn-sm btn-primary' %>
  <br><br>
  <p id =  'preview'></p>
  <hr>

  <div class="form-group">
    <%= f.submit :class => "btn btn-primary btn-sm" %>
  </div>


<script src="//widget.cloudinary.com/global/all.js" type="text/javascript"></script>  
          
<script type="text/javascript">  
  document.getElementById("upload_widget_opener").addEventListener("click", function() {

    cloudinary.openUploadWidget({ cloud_name: 'dy4pzclcw', upload_preset: 'p587tipa', form: 'form', field_name: 'image[]' }, 
      function(error, el) { 
        el.forEach(function(el, i, arr) {
          var preview = $("#preview");

          var a = $('<a/>').attr({href: el.url}).appendTo(preview);

          $.cloudinary.image(el.public_id, {
            format: el.format, width: 50, height: 50, crop: "fit"
          }).attr('id', el.public_id).appendTo(a);

          $('<a/>').
            addClass('delete_by_token').
            attr({href: '#', id: el.public_id}).
            data({delete_token: el.delete_token}).
            html('&times;').
            appendTo(preview).
            click(function(e) {
              e.preventDefault();
              $('img#'+this.id).remove();
              this.remove();
              $.ajax({
                method: 'GET',
                url: '<%= users_delete_image_path %>' + '?public_id=' + this.id,
                success: function(result, status, xhr) {
                  console.log(result, status);
                },
                error: function(result, status, xhr) {
                  console.log(result, status, xhr);
                }
              });
          });
        });
      });
  }, false);

</script>


<% end %>